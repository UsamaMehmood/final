<!doctype html>
<html class="no-js" lang="">
{% load static %}
<head>
    <meta charset="utf-8">
    <title>{% block page_title %}{% endblock %}</title>
    <meta name="description" content="Velyria">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Place favicon.ico in the root directory -->
    <!--  Global css-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker3.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
          integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

    <!--  Custom css-->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    {% block page_styles %}{% endblock %}
    <link rel="stylesheet" href="{% static 'css/form.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">

    <!--  Custom Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!--  global scripts-->
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/bindings/inputmask.binding.min.js"></script>
    <script
            src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"
            integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
            crossorigin="anonymous"></script>
    <script src="{% static 'js/vendor/jquery.mask.min.js' %}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">

    <!--  custom js-->
    <script src="{% static 'js/form-actions.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/ops.js' %}"></script>

</head>

<body id="{% block body_id %}{% endblock %}">
<!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
{% block header %}{% endblock %}
{% block content %}{% endblock %}
<div class="modal fade" id="sharePostModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Share post</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="text" class="share-message" placeholder="Write a message" id="share_message">
                <input type="hidden" id="post_id">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="share_post_button" data-dismiss="modal">Share
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfile"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit profile</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="first_name">First name</label>
                    <input type="text" class="form-control" id="first_name" name="firstname"
                           value="{{ user.first_name }}">
                </div>
                <div class="form-group">
                    <label for="last_name">Last name</label>
                    <input type="text" class="form-control" id="last_name" name="lastname" value="{{ user.last_name }}">
                </div>
                <div class="form-group">
                    <label for="dob">Date of birth</label>
                    <input type="text" class="form-control" id="dob" name="dateofbirth"
                           value="{{ user.date_of_birth|date:'Y-m-d' }}">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="text" class="form-control" id="email" name="email" value="{{ user.email }}">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" class="button-pink" id="edit_profile_button" data-dismiss="modal">Save</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="changePassword"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <form class="form" id="changePasswordModalForm" method="get">
                <div class="modal-header">
                    <h5 class="modal-title">Change password</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" class="form-control" id="password" name="password">
                    </div>
                    <div class="form-group">
                        <label for="confirm">Confirm password</label>
                        <input type="password" class="form-control" id="confirm" name="confirmpassword">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="button-pink" id="change-password-btn" data-dismiss="modal">Change</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="logoutConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="logoutButton"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Logout</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h4>Are you sure you want to logout?</h4>
            </div>
            <div class="modal-footer">
                <form method="post" action="{% url 'auth:logout' %}">
                    {% csrf_token %}
                    <button type="button" class="btn btn-success" data-dismiss="modal">No</button>
                    <input type="submit" class="btn btn-danger" value="Yes">
                </form>
            </div>
        </div>
    </div>
</div>
<span id="fyp-alert">This is an alert!</span>
{% block page_scripts %}{% endblock %}
<script>
    $(document).ready(function () {
        $("#dob").datepicker({ dateFormat: 'yy-mm-dd' });
    });
    {% if user.is_authenticated %}
        $("#share_post_button").on("click", function (e) {
            e.preventDefault();
            var post_id = $("#post_id").val();
            var message = $("#share_message").val();
            $.ajax({
                url: "{% url 'core:api:share-post' %}",
                type: "post",
                data: {
                    post_id: post_id,
                    user_id: "{{ user.pk }}",
                    message: message,
                },
                success: function () {
                    showAlert("You shared the post");
                }
            })
        });

        $("#edit_profile_button").on("click", function (e) {
            var first_name = $("#first_name").val();
            var last_name = $("#last_name").val();
            var dob = $("#dob").val();
            var email = $("#email").val();

            if (first_name.length < 1) {
                first_name = "{{ user.first_name }}";
            }

            if (last_name.length < 1) {
                last_name = "{{ user.last_name }}";
            }

            if (dob.length < 1) {
                dob = "{{ user.date_of_birth|date:'Y-m-d' }}";
            }

            if (email.length < 1) {
                email = "{{ user.email }}";
            }

            $.ajax({
                url: "{% url 'core:api:edit-profile' user.pk %}",
                type: "post",
                data: {
                    first_name: first_name,
                    last_name: last_name,
                    dob: dob,
                    email: email
                },
                success: function (data) {
                    if (data.result === "success") {
                        showAlert("Profile edited successfully! Login again to apply changes");
                    } else {
                        showAlert("Error updating profile!");
                    }
                }
            })
        });

        $("#change-password-btn").on("click", function () {
            var password = $("#password").val();
            var confirm = $("#confirm").val();
            if (password !== confirm) {
                showAlert("Passwords doesn't match");
                return;
            }

            if (password.length < 1 || confirm.length < 1) {
                showAlert("Passwords are required");
                return;
            }

            $.ajax({
                url: "{% url 'core:api:change-password' user.pk %}",
                type: "post",
                data: {
                    password: password,
                    confirm: confirm,
                },
                success: function (data) {
                    if (data.result === "success") {
                        showAlert("Password changed successfully! Login again to apply changes");
                    } else {
                        showAlert("Error changing password!");
                    }
                }
            })

        });
    {% endif %}
</script>
</body>
</html>
